---
---
:ruby
  # may be set by partials
  @config[:include_disqus_js] = false

  def keywords
    if is_front_page?
      tag_set.join(', ') 
    else
      tags = @item[:tags].nil? ? '' : @item[:tags].join(', ') 
      keywords = @item[:keywords] || ''
      [keywords, tags].join(', ')
    end
  end

  def link_unless_current(s)
    if @item.identifier != "/#{s}/" 
      "<li><a href='/#{s}.html'>#{s}</a></li>"   
    else
      "<li><a href='/#{s}.html' class='active'>#{s}</a></li>"   
    end
  end
  
  def logo
    "<a href='/'><img src='"+gravatar_img+"' class='avatar'/></a>"
  end

!!! 5
%html{:"xmlns:og"=>"http://ogp.me/ns#", :"xmlns:fb"=>"https://www.facebook.com/2008/fbml"}
  <!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
  <!--[if lt IE 7 ]> <html class="no-js ie6" lang="en"> <![endif]-->
  <!--[if IE 7 ]>    <html class="no-js ie7" lang="en"> <![endif]-->
  <!--[if IE 8 ]>    <html class="no-js ie8" lang="en"> <![endif]-->
  <!--[if (gte IE 9)|!(IE)]><!--> <html class="no-js" lang="en"> <!--<![endif]-->

  %head
    %title= "#{@item[:title]} - thesp0nge.com"
    %meta{:charset=>"utf-8"}
    %meta{:'http-equiv'=>"X-UA-Compatible", :content=>"IE=edge,chrome=1"}
    %meta{:name=>"description", :content=>"Hi, my name is Paolo Perego and I write secure ruby on rails code for living. With more than 6 years of experience in penetration tests and code review I do understand what's behind an armored code. This is my blog, most of which is written in Italian. But don't be scary, if interested in a post, ask me for a translation. Available for hire as appsec freelancer."}
    %meta{:name=>"author", :content=>"Paolo Perego - paolo@armoredcode.com"}
    %meta{:name=>"title", :content=>"#{@item[:title]} - thesp0nge.com"}


    %link{:href=>'/css/style.css?v=2', :rel=>'stylesheet' }
    %link{:href=>'/css/thesp0nge.css', :rel=>'stylesheet' }

    %link{:href=>'http://fonts.googleapis.com/css?family=Yanone+Kaffeesatz', :rel=>'stylesheet', :type=>'text/css'}
    %script{:src=>"/js/libs/modernizr-1.7.min.js"}

    = @item[:content_for_fb]
 
  %body
    -# needed since some content render <pre> blocks
    - content = find_and_preserve(yield)
    #container
      %header#main 
        = logo
        %h1
          Paolo Perego - secure software craftsman
        %a{:href=>'http://feeds.feedburner.com/Thesp0ngecomAtomFeed', :id=>'rss'}
          %img{:src=>'/images/rss.png', :alt=>'rss', :title=>'Subscribe to this blog\'s RSS feed', :id=>"social"}

      %div#main{:role=>'main'}
        %nav
          %ul
            != link_unless_current "index"
            != link_unless_current "posts"
            != link_unless_current "startup"
            != link_unless_current "puzzle"
            != link_unless_current "books"
            != link_unless_current "talks"
            != link_unless_current "about"
        %hr
        - if @item[:kind] == 'article' 

          %article#fullpage
            = render('_article', :item => @item, :content => content, :show_lang=>true)
          .clearfix
        - if @item[:kind] == 'page' 

          %article#fullpage
            = render('_article', :item => @item, :content => content, :show_lang=>true)
          .clearfix
 
        - if @item[:kind] == 'startup'
          %article#fullpage
            = render('_startup', :item =>@item, :content =>content)
          .clearfix
        - if disqus_shortname && !is_front_page?
          = render('_disqus', :item => @item)
        - elsif @item[:kind] == 'startup'
          =render('_startup', :item=>@item, :content => content)
          .clearfix
        - if disqus_shortname && !is_front_page?
          = render('_disqus', :item => @item)
        - else
          = content
        .clearfix

        = render('_ganalytics')
      .push
    .clearfix
    %footer#site
      #contact
        %ul
          %li
            %a{:href=>"http://twitter.com/thesp0nge"}
              %img{:src=>"/images/twitter.png"}
          %li
            %a{:href=>"https://github.com/thesp0nge"}
              %img{:src=>"/images/github.ico"}
      #license
        %a{:rel=>"license", :href=>"http://creativecommons.org/licenses/by-sa/3.0/"}
          %img{:alt=>"Creative Commons License",:style=>"border-width:0", :src=>"/images/cc.png"}
      #powered
        %span
          Proudly powered by ruby, nanoc, html and css. Last updated: 
          %time
            = pretty_time(item[:updated_at])
      #armored
        %a{:href=>"http://www.armoredcode.com"}
          %img{:src=>"/images/armored_logo.png", :width=>"94px", :height=>"21px"}

